# å‰åç«¯å¯¹æ¥è¯´æ˜

## å·²å®Œæˆçš„åŠŸèƒ½

### âœ… åç«¯æ¥å£

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| ç™»å½• | POST | `/api/auth/login` | ç”¨æˆ·åå¯†ç ç™»å½• |
| éªŒè¯ Token | GET | `/api/auth/validate` | éªŒè¯ Token æœ‰æ•ˆæ€§ |
| ç™»å‡º | POST | `/api/auth/logout` | ç”¨æˆ·ç™»å‡º |

### âœ… å‰ç«¯å¯¹æ¥

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `src/utils/request.js` | Axios é…ç½®å’Œæ‹¦æˆªå™¨ |
| `src/utils/auth.js` | Token å’Œç”¨æˆ·ä¿¡æ¯ç®¡ç† |
| `src/api/login.js` | ç™»å½•ç›¸å…³ API æ¥å£ |
| `src/views/LoginView.vue` | ç™»å½•é¡µé¢ï¼ˆå·²å¯¹æ¥åç«¯ï¼‰ |
| `src/router/index.js` | è·¯ç”±å®ˆå«ï¼ˆå·²æ›´æ–°ï¼‰ |

---

## å¯åŠ¨æ­¥éª¤

### 1. å¯åŠ¨åç«¯æœåŠ¡

è¿›å…¥åç«¯é¡¹ç›®ç›®å½•ï¼š

```bash
cd backend
```

#### 1.1 åˆå§‹åŒ–æ•°æ®åº“

```bash
mysql -u root -p < src/main/resources/sql/init.sql
```

**é»˜è®¤è´¦å·**ï¼š
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`Admin123!`

#### 1.2 ä¿®æ”¹é…ç½®

ä¿®æ”¹ `src/main/resources/application.yml` ä¸­çš„æ•°æ®åº“é…ç½®ï¼š

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/chemicaloop_admin?...
    username: root
    password: your_password
```

#### 1.3 è¿è¡Œé¡¹ç›®

```bash
mvn clean install
mvn spring-boot:run
```

åç«¯æœåŠ¡å°†å¯åŠ¨åœ¨ï¼š`http://localhost:8080`

### 2. å¯åŠ¨å‰ç«¯æœåŠ¡

è¿›å…¥å‰ç«¯é¡¹ç›®ç›®å½•ï¼š

```bash
cd admin
```

#### 2.1 å®‰è£…ä¾èµ–

```bash
pnpm install
```

#### 2.2 è¿è¡Œé¡¹ç›®

```bash
pnpm run dev
```

å‰ç«¯æœåŠ¡å°†å¯åŠ¨åœ¨ï¼š`http://localhost:5001`

---

## æ¥å£å¯¹æ¥è¯´æ˜

### ç™»å½•æ¥å£

**è¯·æ±‚**ï¼š
```
POST http://localhost:8080/api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "Admin123!"
}
```

**å“åº”**ï¼š
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzUxMiJ9...",
    "userId": 1,
    "username": "admin",
    "realName": "ç³»ç»Ÿç®¡ç†å‘˜"
  },
  "timestamp": 1234567890123
}
```

### Token éªŒè¯æ¥å£

**è¯·æ±‚**ï¼š
```
GET http://localhost:8080/api/auth/validate
Authorization: Bearer {token}
```

**å“åº”**ï¼š
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": true,
  "timestamp": 1234567890123
}
```

### ç™»å‡ºæ¥å£

**è¯·æ±‚**ï¼š
```
POST http://localhost:8080/api/auth/logout
Authorization: Bearer {token}
```

**å“åº”**ï¼š
```json
{
  "code": 200,
  "message": "ç™»å‡ºæˆåŠŸ",
  "data": null,
  "timestamp": 1234567890123
}
```

---

## å‰ç«¯é…ç½®

### ä¿®æ”¹åç«¯åœ°å€

å¦‚æœåç«¯æœåŠ¡ä¸åœ¨ `http://localhost:8080`ï¼Œéœ€è¦ä¿®æ”¹ï¼š

**æ–‡ä»¶**ï¼š`src/utils/request.js`

```javascript
const request = axios.create({
  baseURL: 'http://your-backend-address:8080/api', // ä¿®æ”¹è¿™é‡Œ
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json;charset=UTF-8'
  }
})
```

---

## å·¥ä½œæµç¨‹

1. ç”¨æˆ·åœ¨ç™»å½•é¡µé¢è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
2. å‰ç«¯è°ƒç”¨ `/api/auth/login` æ¥å£
3. åç«¯éªŒè¯ç”¨æˆ·åå’Œå¯†ç 
4. éªŒè¯æˆåŠŸåï¼Œåç«¯ç”Ÿæˆ JWT Token
5. å‰ç«¯å­˜å‚¨ Token åˆ° localStorage
6. åç»­è¯·æ±‚ä¼šåœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ Token
7. è·¯ç”±å®ˆå«æ£€æŸ¥ Token æ˜¯å¦å­˜åœ¨
8. Token æœ‰æ•ˆåˆ™å…è®¸è®¿é—®ï¼Œå¦åˆ™è·³è½¬ç™»å½•é¡µ

---

## é”™è¯¯å¤„ç†

### 1. ç½‘ç»œé”™è¯¯

- å‰ç«¯ä¼šæç¤º"ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"
- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨
- æ£€æŸ¥åç«¯åœ°å€é…ç½®æ˜¯å¦æ­£ç¡®

### 2. ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯

- åç«¯è¿”å›ï¼š`{ "code": 500, "message": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯" }`
- å‰ç«¯ä¼šæ˜¾ç¤ºé”™è¯¯æç¤º

### 3. Token è¿‡æœŸ

- åç«¯è¿”å›ï¼š401 é”™è¯¯
- å‰ç«¯ä¼šè‡ªåŠ¨æ¸…é™¤ Token å¹¶è·³è½¬åˆ°ç™»å½•é¡µ

### 4. å‚æ•°é”™è¯¯

- åç«¯è¿”å›ï¼š`{ "code": 400, "message": "..." }`
- å‰ç«¯ä¼šæ˜¾ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯

---

## æµ‹è¯•æ­¥éª¤

### 1. æµ‹è¯•ç™»å½•

1. è®¿é—®ï¼š`http://localhost:5001/login`
2. è¾“å…¥ç”¨æˆ·åï¼š`admin`
3. è¾“å…¥å¯†ç ï¼š`Admin123!`
4. ç‚¹å‡»ç™»å½•æŒ‰é’®
5. æˆåŠŸåè·³è½¬åˆ°é¦–é¡µ

### 2. æµ‹è¯• Token éªŒè¯

1. ç™»å½•æˆåŠŸåï¼Œæ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
2. æŸ¥çœ‹ Application â†’ Local Storage
3. å¤åˆ¶ `token` çš„å€¼
4. ä½¿ç”¨ Postman æˆ– curl æµ‹è¯• `/api/auth/validate` æ¥å£

### 3. æµ‹è¯•æœªç™»å½•è®¿é—®

1. æ¸…é™¤ Local Storage ä¸­çš„ token
2. è®¿é—®éœ€è¦ç™»å½•çš„é¡µé¢ï¼ˆå¦‚é¦–é¡µï¼‰
3. åº”è¯¥è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ

---

## å¸¸è§é—®é¢˜

### Q: ç™»å½•åæç¤º"ç½‘ç»œé”™è¯¯"

A: æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼Œåœ°å€æ˜¯å¦æ­£ç¡®ã€‚

### Q: æç¤º"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"

A: ç¡®è®¤ä½¿ç”¨çš„æ˜¯æ­£ç¡®çš„è´¦å·ï¼š
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`Admin123!`

### Q: Token è¿‡æœŸåæ— æ³•è®¿é—®

A: Token è¿‡æœŸåä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µï¼Œé‡æ–°ç™»å½•å³å¯ã€‚

### Q: å‰ç«¯æ— æ³•è®¿é—®åç«¯æ¥å£

A: æ£€æŸ¥æ˜¯å¦æœ‰è·¨åŸŸé—®é¢˜ã€‚åç«¯å·²é…ç½® `@CrossOrigin` æ³¨è§£ã€‚

---

## åç»­å¼€å‘

### éœ€è¦åç«¯è¿”å› role å­—æ®µ

å½“å‰åç«¯ç™»å½•æ¥å£æ²¡æœ‰è¿”å›ç”¨æˆ·è§’è‰²ï¼ˆroleï¼‰å­—æ®µï¼Œå¯¼è‡´å‰ç«¯æ— æ³•è¿›è¡Œæƒé™æ§åˆ¶ã€‚

**å»ºè®®**ï¼š

ä¿®æ”¹åç«¯ `LoginResponse.java`ï¼Œæ·»åŠ  role å­—æ®µï¼š

```java
@Data
public class LoginResponse implements Serializable {
    private String token;
    private Long userId;
    private String username;
    private String realName;
    private String role; // æ–°å¢
}
```

ç„¶ååœ¨ `AdminUserServiceImpl.java` ä¸­è¿”å›è§’è‰²ä¿¡æ¯ã€‚

### éœ€è¦å®ç°çš„æ¥å£

- ç”¨æˆ·ä¿¡æ¯è·å–
- ä¿®æ”¹å¯†ç 
- ç”¨æˆ·ç®¡ç†ï¼ˆCRUDï¼‰
- è§’è‰²ç®¡ç†
- æƒé™ç®¡ç†

---

## é¡¹ç›®ç»“æ„

```
chemicaloop-website/
â”œâ”€â”€ backend/                 # åç«¯ Spring Boot é¡¹ç›®
â”‚   â”œâ”€â”€ src/main/java/com/chemicaloop/admin/
â”‚   â””â”€â”€ src/main/resources/
â”œâ”€â”€ admin/                   # å‰ç«¯ Vue é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/            # API æ¥å£
â”‚   â”‚   â”œâ”€â”€ utils/          # å·¥å…·ç±»
â”‚   â”‚   â”œâ”€â”€ views/          # é¡µé¢
â”‚   â”‚   â””â”€â”€ router/         # è·¯ç”±
â”‚   â””â”€â”€ package.json
â””â”€â”€ frontend/               # å‰å° Vue é¡¹ç›®
```

---

**å‰åç«¯å¯¹æ¥å·²å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•ï¼** ğŸ‰
